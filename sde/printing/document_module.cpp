#include "sde/printing/detail_/print_inputs.hpp"
#include "sde/printing/detail_/print_results.hpp"
#include "sde/printing/detail_/print_submodules.hpp"
#include "sde/printing/detail_/rest_printer.hpp"
#include "sde/printing/document_module.hpp"
#include <sstream>
#include <utilities/printing/demangler.hpp>
#include <utilities/printing/word_wrap_stream.hpp>

namespace sde::printing {

std::string document_module(std::string name, const Module& mod) {
    std::stringstream ss;
    utilities::printing::WordWrapStream wws(&ss);
    detail_::reSTPrinter p(wws);

    p << ".. comment::\n\n";
    p << "   This page is autogenerated by sde::document_module. Any changes "
         "made\n";
    p << "   to this document will be overwritten the next time it is "
         "generated.\n\n";

    p.start_section(name);
    p << "\n";
    if(mod.has_description()) {
        p << mod.description();
    } else {
        p << "No description provided";
    }
    p << "\n\n";

    p.start_section("Please Cite");
    p << "\n";
    if(mod.citations().empty()) {
        p << "No citations";
    } else {
        for(const auto& x : mod.citations()) p << "- " << x << "\n";
    }
    p << "\n\n";
    p.finish_section();

    p.start_section("Property Types");
    p << "\n";
    if(mod.property_types().empty()) {
        p << "The module satisfies no property types.\n\n";
    } else {
        p << "The following is a list of property types that this module "
             "satisfies.\n\n";
        for(const auto& x : mod.property_types()) {
            p << "- ``" << utilities::printing::Demangler::demangle(x)
              << "``\n";
        }
    }
    p << "\n";
    p.finish_section();

    detail_::print_inputs(p, mod.inputs());
    p << "\n";
    detail_::print_results(p, mod.results());
    detail_::print_submods(p, mod.submods());

    p.finish_section();
    return ss.str();
}

} // namespace sde::printing
